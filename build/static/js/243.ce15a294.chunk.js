"use strict";(self.webpackChunkproperty_manage_system_web=self.webpackChunkproperty_manage_system_web||[]).push([[243],{47569:function(e,n,t){var r=t(74165),a=t(93433),s=t(15861),l=t(29439),i=t(72791),o=t(28958),c=t(15301),u=t(60364),d=t(80184);n.Z=function(e){var n=e.extension,t=(0,i.useState)(void 0),p=(0,l.Z)(t,2),f=p[0],m=p[1],h=(0,i.useState)({val:[]}),v=(0,l.Z)(h,2),g=v[0],x=v[1],j=(0,u.useSelector)((function(e){return e.admin.uploadedFiles})),y=(0,i.useState)([]),N=(0,l.Z)(y,2),b=N[0],Z=N[1],w=(0,i.useState)([]),C=(0,l.Z)(w,2),S=(C[0],C[1]),_=(0,i.useRef)(null),k=(0,u.useDispatch)(),D=(0,u.useSelector)((function(e){return e.auth.jwt}));console.log("extension ="+n),(0,i.useEffect)((function(){k((0,c.C7)()).then((function(e){S(e.data)}))}),[]);var J=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(n,t){var s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,a.Z)(_.current.val),console.log("uploading ..file="+JSON.stringify(t)),e.abrupt("return",o.Z.upload(t,D,(function(e){s[n].percentage=Math.round(100*e.loaded/e.total),x({val:s})})).then((function(e){Z((function(e){return[].concat((0,a.Z)(e),["Uploaded the file successfully: "+t.name])}));var r={id:e.data[0].id,url:e.data[0].url};j.push(r);var s=Array.from(f);(n+=1)<s.length?(A(500),J(n,s[n])):Z((function(e){return[].concat((0,a.Z)(e),["Uploaded Completed!"])}))})).catch((function(e){console.log("upload file error.."+JSON.stringify(e)),s[n].percentage=0,x({val:s}),Z((function(e){return[].concat((0,a.Z)(e),["Could not upload the file: "+t.name])}))})));case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),A=function(e){return new Promise((function(n){return setTimeout(n,e)}))};return(0,d.jsxs)("div",{children:[g&&g.val.length>0&&g.val.map((function(e,n){return(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("span",{children:e.fileName}),(0,d.jsx)("div",{className:"progress",children:(0,d.jsxs)("div",{className:"progress-bar progress-bar-info",role:"progressbar","aria-valuenow":e.percentage,"aria-valuemin":"0","aria-valuemax":"100",style:{width:e.percentage+"%"},children:[e.percentage,"%"]})})]},n)})),(0,d.jsxs)("div",{className:"row my-3",children:[(0,d.jsx)("div",{className:"col-8",children:(0,d.jsx)("label",{className:"btn btn-default p-0",children:(0,d.jsx)("input",{type:"file",accept:n,multiple:!0,onChange:function(e){m(e.target.files),console.log("file selected.."+JSON.stringify(e.target.files)),x({val:[]})}})})}),(0,d.jsx)("div",{className:"col-4",children:(0,d.jsx)("button",{className:"btn btn-success btn-sm",disabled:!f,onClick:function(e){e.preventDefault();var n=Array.from(f);console.log("files..."+JSON.stringify(n));var t=n.map((function(e){return{percentage:0,fileName:e.name}}));_.current={val:t},J(0,n[0])},children:"Upload"})})]}),b.length>0&&(0,d.jsx)("div",{className:"alert alert-secondary",role:"alert",children:(0,d.jsx)("ul",{children:b.map((function(e,n){return(0,d.jsx)("li",{children:e},n)}))})})]})}},28958:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(74569),a=t.n(r)().create({headers:{"Content-type":"application/json"}}),s=t(83708),l={upload:function(e,n,t){var r=new FormData;return r.append("files",e),a.post(s.rq+"/upload",r,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(n)},onUploadProgress:t})},getFiles:function(e){return a.get(s.rq+"/upload/files?_limit=10&_start=0&_sort=updatedAt:DESC")}}},86243:function(e,n,t){t.r(n),t.d(n,{default:function(){return d}});var r=t(72791),a=t(60364),s=t(56994),l=t(47569),i=t(19246),o=(t(83309),t(15301)),c=t(36530),u=t(80184),d=function(){var e=(0,a.useSelector)((function(e){return e.admin.uploadedFiles})),n=(0,a.useDispatch)(),t=(0,r.useCallback)((function(){console.log(". start to import csv data...uploadedFiles.."+JSON.stringify(e));var t={fileName:e[0].url};n((0,o.NA)(t)).then((function(e){console.log("...batch import ..",e)})).catch((function(e){console.log("..import error"),c.Rt.error("Error","Data import failed")}))}));return(0,u.jsxs)("div",{className:"c-app c-default-layout",children:[(0,u.jsx)(i.BX,{}),(0,u.jsxs)("div",{className:"c-wrapper",children:[(0,u.jsx)(i.Jb,{}),(0,u.jsx)("div",{className:"c-body",children:(0,u.jsx)("main",{className:"c-main",children:(0,u.jsx)(s.KB,{fluid:!0,className:"h-100",children:(0,u.jsx)("div",{className:"content",children:(0,u.jsxs)("div",{className:"container",style:{width:"600px"},children:[(0,u.jsx)("div",{className:"my-3",children:(0,u.jsx)("h4",{children:"Batch  Import Company"})}),(0,u.jsx)(l.Z,{extension:".csv"}),(0,u.jsx)("hr",{}),(0,u.jsx)(s.u5,{onClick:function(){return t()},type:"button",size:"sm",color:"primary",children:"Import"})," "]})})})})}),(0,u.jsx)(i.Wm,{})]})]})}}}]);
//# sourceMappingURL=243.ce15a294.chunk.js.map